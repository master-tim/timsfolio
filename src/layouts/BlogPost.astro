---
import type { CollectionEntry } from "astro:content";
import BaseHead from "@/components/BaseHead.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import { Icon } from "astro-icon/components";
import AntigravityEffect from "@/components/AntigravityEffect.astro";
import  Analytics  from '@vercel/analytics/astro';
import  SpeedInsights  from "@vercel/speed-insights/astro";

type Props = CollectionEntry<"blog">["data"];

const {
  title = "",
  description,
  pubDate,
  updatedDate,
  heroImage = "/fran.webp",
  icon,
  tags,
} = Astro.props;
import { getCollection } from "astro:content";
const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
const bgClasses = [
  "hover:shadow-ppinkHover",
  "hover:shadow-pgreenHover",
  "hover:shadow-pblueHover",
  "hover:shadow-pyellow",

];
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/**/*.{webp,jpeg,jpg,png,gif}')
if (!images[heroImage]) throw new Error(`"${heroImage}" does not exist in glob: "src/assets/**/*.{webp,jpeg,jpg,png,gif}"`);

const getRandomClass = () => {
  return bgClasses[Math.floor(Math.random() * bgClasses.length)];
};
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
  </head>
  <body>
    <AntigravityEffect />
    <Header />
    <main class="container mx-auto text-white">
      <article >
        <div class="relative mb-20 h-[50vh] min-h-[400px] w-full overflow-hidden rounded-xl" transition:animate="fade">
          <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent z-10"></div>
          <Image src={images[heroImage]()} alt={title} class="absolute inset-0 w-full h-full object-cover" />
          
          <div class="absolute bottom-0 left-0 p-6 md:p-12 z-20 w-full max-w-5xl">
            <h1 class="text-4xl md:text-6xl font-bold leading-tight text-white mb-4 drop-shadow-lg">
              <span class="font-kablamo text-ppink">{title.charAt(0)}</span>{title.slice(1)}
            </h1>
            {description && (
              <p class="text-lg md:text-xl text-gray-200 max-w-3xl leading-relaxed drop-shadow-md" set:html={description} />
            )}
          </div>
        </div>
        <div class="text-black px-6 md:px-0">
          <div class="">
            <div class="text-sm text-pblack flex items-center justify-between">
              <FormattedDate date={pubDate} />
              {
                updatedDate && (
                  <div class="last-updated-on">
                    Last updated on <FormattedDate date={updatedDate} />
                  </div>
                )
              }
              <Icon name={icon} class="text-5xl" transition:animate="fade" />
            </div>

            <hr />
          </div>
          <div class="flex justify-between py-10 md:flex-row flex-col">
            <div class="prose md:w-1/2 flex flex-col gap-6">
              <slot />
            </div>
            <div class="flex flex-col gap-6 items-start md:items-end text-right" transition:animate="slide">
              <ul class="flex flex-col gap-2 pt-10 md:pt-0 items-start md:items-end">
                <p class="md:hidden font-semibold">Related:</p>
                {
                  posts.map((post) => {
                    return (
                      <li class=`text-left rounded-lg border-1 border-black shadow-card group hover:shadow-hover transition  px-2 py-2 ${getRandomClass()}` >
                        <a
                          href={`/blog/${post.id}/`}
                        >
                          <h4 >{post.data.title}</h4>
                        </a>
                      </li>
                    );
                  })
                }
              </ul>
              <hr class="w-full" />
              <p>Written by</p>
              <div class="flex -mt-4 gap-2 flex-row-reverse text-right">
                  <div class="bg-pgreen rounded-full w-12 h-12 aspect-square object-contain overflow-hidden ">
                    <Image src={images["/src/assets/tims.png"]()} alt="Temirlan" />
                  </div>
                  <div>
                  <h3>Temirlan Dzhoroev</h3>
                  <p class="text-pblack">Full-stack AI Engineer<br>Frontend 3D Developer</p>
                </div>
              </div>
              <hr class="w-full"/>
              <div>
                <p>Connect:</p>
                <div class="flex items-center gap-6 text-xl">
                  <a
                    href="https://github.com/master-tim"
                    target="_blank"
                    class="border-1 p-1 border-black rounded-full bg-pblue shadow-card hover:shadow-hover transition"
                  >
                    <Icon name="github" />
                  </a>
                  <a
                    href="https://www.linkedin.com/in/dzhoroev7"
                    target="_blank"
                    class="border-1 p-1 border-black rounded-full bg-pgreen shadow-card hover:shadow-hover transition"
                  >
                    <Icon name="linkedin" />
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </article>
    </main>
    <Footer />
    <Analytics />
    <SpeedInsights />
  </body>
</html>
